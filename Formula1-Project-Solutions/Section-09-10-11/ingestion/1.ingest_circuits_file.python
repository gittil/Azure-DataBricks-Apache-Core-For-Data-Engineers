{"version":"NotebookV1","origId":4277921907349083,"name":"1.ingest_circuits_file","language":"python","commands":[{"version":"CommandV1","origId":4277921907349084,"guid":"fb505a5f-eec8-4ce1-9320-900c1c5a814e","subtype":"command","commandType":"auto","position":1.0,"command":"%md\n### Ingest circuits.csv file","commandVersion":14,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3a8e0d4b-189b-457f-84a2-08d6e00fafee"},{"version":"CommandV1","origId":4277921907349085,"guid":"d552cddd-66e4-4000-b42e-29be4573edde","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n##### Step 1 - Read the CSV file using the spark dataframe reader","commandVersion":16,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"db85a924-7e7d-430f-b3df-16118c92ca17"},{"version":"CommandV1","origId":4277921907349086,"guid":"8397c30d-d23c-4d27-b85e-fac0778cf2fd","subtype":"command","commandType":"auto","position":2.75,"command":"from pyspark.sql.types import StructType, StructField, IntegerType, StringType, DoubleType","commandVersion":1,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b10e4d23-3471-4964-a653-530508a92fa0"},{"version":"CommandV1","origId":4277921907349087,"guid":"47129ffb-9a7b-40eb-9a3d-6fa4207407fe","subtype":"command","commandType":"auto","position":2.875,"command":"circuits_schema = StructType(fields=[StructField(\"circuitId\", IntegerType(), False),\n                                     StructField(\"circuitRef\", StringType(), True),\n                                     StructField(\"name\", StringType(), True),\n                                     StructField(\"location\", StringType(), True),\n                                     StructField(\"country\", StringType(), True),\n                                     StructField(\"lat\", DoubleType(), True),\n                                     StructField(\"lng\", DoubleType(), True),\n                                     StructField(\"alt\", IntegerType(), True),\n                                     StructField(\"url\", StringType(), True)\n])","commandVersion":71,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5fcb1b85-0a5a-4d02-aef2-9b4e77883768"},{"version":"CommandV1","origId":4277921907349088,"guid":"3b81967e-371f-46a9-a518-758383d92b1e","subtype":"command","commandType":"auto","position":3.0,"command":"circuits_df = spark.read \\\n.option(\"header\", True) \\\n.schema(circuits_schema) \\\n.csv(\"/mnt/formula1dl/raw/circuits.csv\")","commandVersion":68,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d8f5e48e-6eda-416e-bec9-583ecd393714"},{"version":"CommandV1","origId":4277921907349089,"guid":"4a70494f-2390-4825-92b2-856d355b1075","subtype":"command","commandType":"auto","position":17.0,"command":"%md\n##### Step 2 - Select only the required columns","commandVersion":17,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"658c423a-9725-4ba9-bfaa-96108e2efe9e"},{"version":"CommandV1","origId":4277921907349090,"guid":"46493953-a283-416a-ab50-d0dedc9f0c36","subtype":"command","commandType":"auto","position":18.875,"command":"from pyspark.sql.functions import col","commandVersion":12,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2286ebb7-9d23-4e49-b481-fdfaf721ad2a"},{"version":"CommandV1","origId":4277921907349091,"guid":"46962faf-b721-43b6-9553-84bb610908e8","subtype":"command","commandType":"auto","position":18.9375,"command":"circuits_selected_df = circuits_df.select(col(\"circuitId\"), col(\"circuitRef\"), col(\"name\"), col(\"location\"), col(\"country\"), col(\"lat\"), col(\"lng\"), col(\"alt\"))","commandVersion":34,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a18e2fa8-da45-45b6-826a-bddab0be32c2"},{"version":"CommandV1","origId":4277921907349092,"guid":"e644bca0-7508-4a80-9375-32f259e6bfb6","subtype":"command","commandType":"auto","position":20.0,"command":"%md\n##### Step 3 - Rename the columns as required","commandVersion":14,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"36ae8412-ae50-4c72-9183-0248d2af24e7"},{"version":"CommandV1","origId":4277921907349093,"guid":"d8209b2a-4c9c-4b4a-9faa-e332847ff4a4","subtype":"command","commandType":"auto","position":21.0,"command":"circuits_renamed_df = circuits_selected_df.withColumnRenamed(\"circuitId\", \"circuit_id\") \\\n.withColumnRenamed(\"circuitRef\", \"circuit_ref\") \\\n.withColumnRenamed(\"lat\", \"latitude\") \\\n.withColumnRenamed(\"lng\", \"longitude\") \\\n.withColumnRenamed(\"alt\", \"altitude\") ","commandVersion":58,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b17e11c4-82f3-458c-be26-540aebfcc2d9"},{"version":"CommandV1","origId":4277921907349094,"guid":"5f5acaf1-0890-4261-a2b9-d07443ca1a72","subtype":"command","commandType":"auto","position":23.0,"command":"%md \n##### Step 4 - Add ingestion date to the dataframe","commandVersion":18,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bd0ea1c5-85f6-42c2-bc22-b159e4ab5a62"},{"version":"CommandV1","origId":4277921907349095,"guid":"c1f842ca-5ded-4fba-b4a4-81e9c43159ec","subtype":"command","commandType":"auto","position":23.5,"command":"from pyspark.sql.functions import current_timestamp","commandVersion":15,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c9cf5690-044a-430f-951a-fb6a20c492ed"},{"version":"CommandV1","origId":4277921907349096,"guid":"c57132ad-a7a0-4c32-b556-38730e4d07f2","subtype":"command","commandType":"auto","position":24.0,"command":"circuits_final_df = circuits_renamed_df.withColumn(\"ingestion_date\", current_timestamp()) ","commandVersion":56,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b083479a-f952-4451-9e5d-3f95cdba8329"},{"version":"CommandV1","origId":4277921907349097,"guid":"ee09dec3-dc2e-4daa-8c1b-1c9b66de7d9f","subtype":"command","commandType":"auto","position":26.0,"command":"%md\n##### Step 5 - Write data to datalake as parquet","commandVersion":12,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1f8fd832-7823-49da-bbf4-296da097e86e"},{"version":"CommandV1","origId":4277921907349098,"guid":"4778808f-3054-4c9e-aa3e-6ef5ee02276a","subtype":"command","commandType":"auto","position":27.0,"command":"circuits_final_df.write.mode(\"overwrite\").parquet(\"/mnt/formula1dl/processed/circuits\")","commandVersion":30,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e3fb0d28-e743-4fe3-99c5-fb35eff49c15"},{"version":"CommandV1","origId":4277921907349099,"guid":"1d623fe8-2312-4b92-a207-9a01340f100b","subtype":"command","commandType":"auto","position":31.0,"command":"display(spark.read.parquet(\"/mnt/formula1dl/processed/circuits\"))","commandVersion":8,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"1356","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9c9f688f-438f-4421-b56f-59a5698aef71"},{"version":"CommandV1","origId":4277921907349100,"guid":"d0a847bc-e0c0-4020-aa9c-263810458355","subtype":"command","commandType":"auto","position":32.0,"command":"","commandVersion":0,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c00f4f21-8b93-4c06-bdc2-32a8d51ffa93"}],"dashboards":[],"guid":"6164b597-7a04-4462-90a7-d4a4fde6081d","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2}}
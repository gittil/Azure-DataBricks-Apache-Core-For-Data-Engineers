{"version":"NotebookV1","origId":4277921907350234,"name":"1.race_results","language":"python","commands":[{"version":"CommandV1","origId":4277921907350235,"guid":"ff93cf5e-3112-43c9-9ea4-e49e88517c91","subtype":"command","commandType":"auto","position":0.5,"command":"dbutils.widgets.text(\"p_file_date\", \"2021-03-21\")\nv_file_date = dbutils.widgets.get(\"p_file_date\")","commandVersion":1,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ff77c254-1aea-4f9f-b48f-28519bcbcd43"},{"version":"CommandV1","origId":4277921907350236,"guid":"609d2119-6c5f-4abe-afde-53fbfe41efca","subtype":"command","commandType":"auto","position":1.0,"command":"%md\n##### Read all the data as required","commandVersion":9,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5b2addf1-d81d-42ac-a5ee-f9e15689804d"},{"version":"CommandV1","origId":4277921907350237,"guid":"bb1c6158-3fa7-47d3-b9b7-56eeda27eec5","subtype":"command","commandType":"auto","position":2.0,"command":"%run \"../includes/configuration\"","commandVersion":10,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dbad2b1d-1411-41df-a270-e0b77eb04c96"},{"version":"CommandV1","origId":4277921907350239,"guid":"891463a2-32ec-4217-99d5-e50d31f25fdb","subtype":"command","commandType":"auto","position":3.0,"command":"%run \"../includes/common_functions\"","commandVersion":5,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"75fc2699-3ad9-445d-912f-93f51d6756c4"},{"version":"CommandV1","origId":4277921907350245,"guid":"f292b081-4c8b-48aa-af0d-948a460daf09","subtype":"command","commandType":"auto","position":4.0,"command":"drivers_df = spark.read.format(\"delta\").load(f\"{processed_folder_path}/drivers\") \\\n.withColumnRenamed(\"number\", \"driver_number\") \\\n.withColumnRenamed(\"name\", \"driver_name\") \\\n.withColumnRenamed(\"nationality\", \"driver_nationality\") ","commandVersion":56,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5f9b33a8-00b3-450f-8f34-8ae02e168a4e"},{"version":"CommandV1","origId":4277921907350246,"guid":"cb46d9ca-04af-413b-88ef-4e0e862f1322","subtype":"command","commandType":"auto","position":5.0,"command":"constructors_df = spark.read.format(\"delta\").load(f\"{processed_folder_path}/constructors\") \\\n.withColumnRenamed(\"name\", \"team\") ","commandVersion":16,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1e1f003e-4cac-44ec-bc9d-6acfa5bbd321"},{"version":"CommandV1","origId":4277921907350247,"guid":"2f75d528-d35b-4b98-8798-ea6a9da98e88","subtype":"command","commandType":"auto","position":6.0,"command":"circuits_df = spark.read.format(\"delta\").load(f\"{processed_folder_path}/circuits\") \\\n.withColumnRenamed(\"location\", \"circuit_location\") ","commandVersion":19,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6d8b4aa5-ef46-4a39-b475-b8b406c5bddd"},{"version":"CommandV1","origId":4277921907350248,"guid":"0613b057-c6f9-409d-b9e5-19d1b0ec19dd","subtype":"command","commandType":"auto","position":7.0,"command":"races_df = spark.read.format(\"delta\").load(f\"{processed_folder_path}/races\") \\\n.withColumnRenamed(\"name\", \"race_name\") \\\n.withColumnRenamed(\"race_timestamp\", \"race_date\") ","commandVersion":51,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"45265110-2097-431a-91a7-44d659c5df10"},{"version":"CommandV1","origId":4277921907350249,"guid":"a69d6382-29bf-4f87-bf91-fe6c32dc004e","subtype":"command","commandType":"auto","position":8.0,"command":"results_df = spark.read.format(\"delta\").load(f\"{processed_folder_path}/results\") \\\n.filter(f\"file_date = '{v_file_date}'\") \\\n.withColumnRenamed(\"time\", \"race_time\") \\\n.withColumnRenamed(\"race_id\", \"result_race_id\") \\\n.withColumnRenamed(\"file_date\", \"result_file_date\") ","commandVersion":98,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c1524d6c-92c2-450b-9680-e8daa5272bdf"},{"version":"CommandV1","origId":4277921907350250,"guid":"51c08656-4afe-40f9-bbec-1cc34e32334f","subtype":"command","commandType":"auto","position":9.0,"command":"%md\n##### Join circuits to races","commandVersion":7,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"41d1ebe5-4470-496a-84b4-8085d53ae94f"},{"version":"CommandV1","origId":4277921907350251,"guid":"03ddb07b-01cc-4e3e-946e-3c149d6b230d","subtype":"command","commandType":"auto","position":10.0,"command":"race_circuits_df = races_df.join(circuits_df, races_df.circuit_id == circuits_df.circuit_id, \"inner\") \\\n.select(races_df.race_id, races_df.race_year, races_df.race_name, races_df.race_date, circuits_df.circuit_location)","commandVersion":66,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"388f5e91-e4b0-4ad6-84fc-5f6a65da6dac"},{"version":"CommandV1","origId":4277921907350252,"guid":"0ff4f75d-5054-4038-bfa3-35b95b26c4a4","subtype":"command","commandType":"auto","position":11.0,"command":"%md\n##### Join results to all other dataframes","commandVersion":11,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a5fe4fa1-caa2-4f72-83ae-7b5deb7e4e2f"},{"version":"CommandV1","origId":4277921907350253,"guid":"70b99591-8c2f-452c-97bc-df2e13b5ce77","subtype":"command","commandType":"auto","position":12.0,"command":"race_results_df = results_df.join(race_circuits_df, results_df.result_race_id == race_circuits_df.race_id) \\\n                            .join(drivers_df, results_df.driver_id == drivers_df.driver_id) \\\n                            .join(constructors_df, results_df.constructor_id == constructors_df.constructor_id)","commandVersion":89,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5b5c9e3c-af2b-49bb-a2c6-47849fc829ae"},{"version":"CommandV1","origId":4277921907350254,"guid":"94de1492-78a2-4fb4-b2b0-d69c0331b9a6","subtype":"command","commandType":"auto","position":12.5,"command":"from pyspark.sql.functions import current_timestamp","commandVersion":13,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5becc691-615a-47c8-80f5-c128cc907259"},{"version":"CommandV1","origId":4277921907350255,"guid":"ff55ffd5-54e9-4f29-8c00-fbe06974272a","subtype":"command","commandType":"auto","position":13.75,"command":"final_df = race_results_df.select(\"race_id\", \"race_year\", \"race_name\", \"race_date\", \"circuit_location\", \"driver_name\", \"driver_number\", \"driver_nationality\",\n                                 \"team\", \"grid\", \"fastest_lap\", \"race_time\", \"points\", \"position\", \"result_file_date\") \\\n                          .withColumn(\"created_date\", current_timestamp()) \\\n                          .withColumnRenamed(\"result_file_date\", \"file_date\") ","commandVersion":46,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5aba464e-6908-49a8-a819-8e52e299d5bb"},{"version":"CommandV1","origId":4277921907350256,"guid":"ac89c659-ff38-4840-84be-349663362a37","subtype":"command","commandType":"auto","position":19.0,"command":"merge_condition = \"tgt.driver_name = src.driver_name AND tgt.race_id = src.race_id\"\nmerge_delta_data(final_df, 'f1_presentation', 'race_results', presentation_folder_path, merge_condition, 'race_id')","commandVersion":15,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"caa50c79-49f5-4f93-930c-36dc3f7f521f"},{"version":"CommandV1","origId":4277921907350257,"guid":"382a881d-3407-4464-a74d-a749fc3858cf","subtype":"command","commandType":"auto","position":20.0,"command":"%sql\nSELECT * FROM f1_presentation.race_results;","commandVersion":5,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"2388","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"69940f9a-a118-490e-a501-63eb1e2e9345"},{"version":"CommandV1","origId":4277921907350258,"guid":"aad71272-900d-4618-a3ba-bd4d58b3df90","subtype":"command","commandType":"auto","position":32.0,"command":"","commandVersion":0,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0370319c-b1b0-4f46-b62a-f44549b9e502"}],"dashboards":[],"guid":"ec6f91f8-5366-4a1a-9e6f-a3e42957f450","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"p_file_date":{"nuid":"ac78ea22-22df-4cf1-b2c7-1fbd895ee73e","currentValue":"2021-04-18","widgetInfo":{"widgetType":"text","name":"p_file_date","defaultValue":"2021-03-21","label":null,"options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":2}}
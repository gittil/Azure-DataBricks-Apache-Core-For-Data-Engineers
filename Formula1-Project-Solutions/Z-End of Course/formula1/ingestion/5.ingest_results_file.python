{"version":"NotebookV1","origId":4277921907351358,"name":"5.ingest_results_file","language":"python","commands":[{"version":"CommandV1","origId":4277921907351359,"guid":"33ae691b-4c9e-4f50-837c-d7a2008b6a76","subtype":"command","commandType":"auto","position":1.0,"command":"%md\n### Ingest results.json file","commandVersion":10,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1d086d17-8f9f-4c81-8473-1e56668cbad9"},{"version":"CommandV1","origId":4277921907351360,"guid":"a2102faf-c637-4042-a7f9-fda0d848dcf3","subtype":"command","commandType":"auto","position":1.25,"command":"dbutils.widgets.text(\"p_data_source\", \"\")\nv_data_source = dbutils.widgets.get(\"p_data_source\")","commandVersion":1,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"adcc84ef-d4a2-401b-a3db-0243dec5a36c"},{"version":"CommandV1","origId":4277921907351361,"guid":"6201b4b3-89c5-4506-b0ff-637225860d70","subtype":"command","commandType":"auto","position":1.375,"command":"dbutils.widgets.text(\"p_file_date\", \"2021-03-28\")\nv_file_date = dbutils.widgets.get(\"p_file_date\")","commandVersion":2,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"aa39f920-e291-483d-8a93-cfa94ec3bbf6"},{"version":"CommandV1","origId":4277921907351362,"guid":"6e425383-b956-41da-8a1f-f2c7a4e942f6","subtype":"command","commandType":"auto","position":1.5,"command":"%run \"../includes/configuration\"","commandVersion":1,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f6e8a76b-a89f-48f7-8f15-788f471f85ae"},{"version":"CommandV1","origId":4277921907351363,"guid":"c88f4c73-95e6-47c6-a2c5-692b13578dcd","subtype":"command","commandType":"auto","position":1.75,"command":"%run \"../includes/common_functions\"","commandVersion":1,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c6a92d4e-af00-48b8-80d8-1bd4f98b440f"},{"version":"CommandV1","origId":4277921907351364,"guid":"2fd19203-964a-4891-bbe2-4e109a1cd4b3","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n##### Step 1 - Read the JSON file using the spark dataframe reader API","commandVersion":21,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c10a9b41-e54b-4be3-9579-680b36628fdb"},{"version":"CommandV1","origId":4277921907351365,"guid":"681057cf-d41d-4346-8258-7e630f2684f5","subtype":"command","commandType":"auto","position":2.5,"command":"from pyspark.sql.types import StructType, StructField, IntegerType, StringType, FloatType","commandVersion":31,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"61fa87da-9c0b-4cad-be57-16705af9ca63"},{"version":"CommandV1","origId":4277921907351366,"guid":"9022b753-86ab-4217-8800-80dbb3eb1172","subtype":"command","commandType":"auto","position":2.75,"command":"results_schema = StructType(fields=[StructField(\"resultId\", IntegerType(), False),\n                                    StructField(\"raceId\", IntegerType(), True),\n                                    StructField(\"driverId\", IntegerType(), True),\n                                    StructField(\"constructorId\", IntegerType(), True),\n                                    StructField(\"number\", IntegerType(), True),\n                                    StructField(\"grid\", IntegerType(), True),\n                                    StructField(\"position\", IntegerType(), True),\n                                    StructField(\"positionText\", StringType(), True),\n                                    StructField(\"positionOrder\", IntegerType(), True),\n                                    StructField(\"points\", FloatType(), True),\n                                    StructField(\"laps\", IntegerType(), True),\n                                    StructField(\"time\", StringType(), True),\n                                    StructField(\"milliseconds\", IntegerType(), True),\n                                    StructField(\"fastestLap\", IntegerType(), True),\n                                    StructField(\"rank\", IntegerType(), True),\n                                    StructField(\"fastestLapTime\", StringType(), True),\n                                    StructField(\"fastestLapSpeed\", FloatType(), True),\n                                    StructField(\"statusId\", StringType(), True)])","commandVersion":43,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"059a5f92-5e4d-4bc0-a45c-26ce6fd8feeb"},{"version":"CommandV1","origId":4277921907351367,"guid":"47113dbc-cca7-45e0-a3d8-4de2e2a2aaa1","subtype":"command","commandType":"auto","position":2.9375,"command":"results_df = spark.read \\\n.schema(results_schema) \\\n.json(f\"{raw_folder_path}/{v_file_date}/results.json\")","commandVersion":41,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fd8e1ade-2c64-4846-922c-22aac59174ab"},{"version":"CommandV1","origId":4277921907351368,"guid":"c085987c-307a-4f92-a64a-a502afde4af1","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n##### Step 2 - Rename columns and add new columns","commandVersion":62,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"11a12637-558c-4342-8375-821d65060739"},{"version":"CommandV1","origId":4277921907351369,"guid":"90d21ed4-5166-4c57-aa20-8a8199d6deac","subtype":"command","commandType":"auto","position":3.375,"command":"from pyspark.sql.functions import lit","commandVersion":1,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b91a57ac-2007-409d-bce9-342c80193202"},{"version":"CommandV1","origId":4277921907351370,"guid":"0e71eae9-31ce-43e4-a3da-e808d24bbc55","subtype":"command","commandType":"auto","position":3.75,"command":"results_with_columns_df = results_df.withColumnRenamed(\"resultId\", \"result_id\") \\\n                                    .withColumnRenamed(\"raceId\", \"race_id\") \\\n                                    .withColumnRenamed(\"driverId\", \"driver_id\") \\\n                                    .withColumnRenamed(\"constructorId\", \"constructor_id\") \\\n                                    .withColumnRenamed(\"positionText\", \"position_text\") \\\n                                    .withColumnRenamed(\"positionOrder\", \"position_order\") \\\n                                    .withColumnRenamed(\"fastestLap\", \"fastest_lap\") \\\n                                    .withColumnRenamed(\"fastestLapTime\", \"fastest_lap_time\") \\\n                                    .withColumnRenamed(\"fastestLapSpeed\", \"fastest_lap_speed\") \\\n                                    .withColumn(\"data_source\", lit(v_data_source)) \\\n                                    .withColumn(\"file_date\", lit(v_file_date))","commandVersion":231,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"50592917-97ec-4c67-b891-1027c955e066"},{"version":"CommandV1","origId":4277921907351371,"guid":"7935c609-1e1e-4365-8a69-ef8727c5726e","subtype":"command","commandType":"auto","position":3.875,"command":"results_with_ingestion_date_df = add_ingestion_date(results_with_columns_df)","commandVersion":6,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c15794d7-06da-48ae-867d-b3a47f15585e"},{"version":"CommandV1","origId":4277921907351372,"guid":"a8ccd1c6-68e0-41a2-87ee-d6cb7f2da22e","subtype":"command","commandType":"auto","position":4.0,"command":"%md\n##### Step 3 - Drop the unwanted column","commandVersion":31,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"70470f00-def4-4cf1-a883-1495b79bfa71"},{"version":"CommandV1","origId":4277921907351373,"guid":"d6c6768c-1587-452e-a904-279f787e682b","subtype":"command","commandType":"auto","position":4.25,"command":"from pyspark.sql.functions import col","commandVersion":2,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"38384750-83f9-4a39-8883-e65da4ca4465"},{"version":"CommandV1","origId":4277921907351374,"guid":"ee5a682a-8298-4a59-a545-972127cadd9b","subtype":"command","commandType":"auto","position":4.5,"command":"results_final_df = results_with_ingestion_date_df.drop(col(\"statusId\"))","commandVersion":17,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"36dedb37-ac08-45c1-8935-b8bbd450e9a8"},{"version":"CommandV1","origId":4277921907351375,"guid":"ceb60599-fb72-4cf5-8719-af4970cc5b00","subtype":"command","commandType":"auto","position":4.75,"command":"%md\nDe-dupe the dataframe","commandVersion":11,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9370ebb5-30c2-4c7b-bd9e-7ee9fd84bfc8"},{"version":"CommandV1","origId":4277921907351376,"guid":"01a8f275-7415-417a-948d-6b1631b9da54","subtype":"command","commandType":"auto","position":4.875,"command":"results_deduped_df = results_final_df.dropDuplicates(['race_id', 'driver_id'])","commandVersion":19,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"60385707-c3ef-4aa1-90f3-69ad18b10945"},{"version":"CommandV1","origId":4277921907351377,"guid":"0a067495-82d8-4951-9240-1c9cc3cabc42","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n##### Step 4 - Write to output to processed container in parquet format","commandVersion":23,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2322063f-9693-4033-b70d-df6091c05224"},{"version":"CommandV1","origId":4277921907351378,"guid":"b1f5ca16-8b92-4a1e-ba5c-eed2a00d01c1","subtype":"command","commandType":"auto","position":5.25,"command":"%md\nMethod 1","commandVersion":5,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ab18391f-8989-4953-a67e-9770ca9d791b"},{"version":"CommandV1","origId":4277921907351379,"guid":"6d24d193-d40d-4e6b-a123-6849f2f1fea0","subtype":"command","commandType":"auto","position":5.5,"command":"# for race_id_list in results_final_df.select(\"race_id\").distinct().collect():\n#   if (spark._jsparkSession.catalog().tableExists(\"f1_processed.results\")):\n#     spark.sql(f\"ALTER TABLE f1_processed.results DROP IF EXISTS PARTITION (race_id = {race_id_list.race_id})\")","commandVersion":75,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5b8ea87d-2eb4-4e2c-8996-04a9550ab339"},{"version":"CommandV1","origId":4277921907351380,"guid":"41e0da85-47e0-412b-af7f-77bce2d0d7d1","subtype":"command","commandType":"auto","position":6.0,"command":"# results_final_df.write.mode(\"append\").partitionBy('race_id').format(\"parquet\").saveAsTable(\"f1_processed.results\")","commandVersion":49,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1800a861-9f54-459c-a37d-d020a761991b"},{"version":"CommandV1","origId":4277921907351381,"guid":"143f2560-a583-461d-aae2-94df761d6265","subtype":"command","commandType":"auto","position":7.0,"command":"%md\nMethod 2","commandVersion":1,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"34d9c19b-a066-4bdc-b8a7-05ce92438f31"},{"version":"CommandV1","origId":4277921907351382,"guid":"cac3ac53-e9d5-4356-a8a6-223481d21a0d","subtype":"command","commandType":"auto","position":7.05859375,"command":"# overwrite_partition(results_final_df, 'f1_processed', 'results', 'race_id')","commandVersion":2,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"2396","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1bfc3ed9-5a7f-4588-843e-915e7fcd1c8c"},{"version":"CommandV1","origId":4277921907351383,"guid":"3f140ce4-253a-4aae-8011-78c4f5c46e20","subtype":"command","commandType":"auto","position":7.2939453125,"command":"merge_condition = \"tgt.result_id = src.result_id AND tgt.race_id = src.race_id\"\nmerge_delta_data(results_deduped_df, 'f1_processed', 'results', processed_folder_path, merge_condition, 'race_id')","commandVersion":30,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"46cac9cd-2701-4246-b506-c51a929be46c"},{"version":"CommandV1","origId":4277921907351384,"guid":"99dee59b-cec1-43c6-a89f-0f59e6691125","subtype":"command","commandType":"auto","position":8.0,"command":"dbutils.notebook.exit(\"Success\")","commandVersion":1,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b352a725-a812-4941-8aec-3d6f3c631b63"},{"version":"CommandV1","origId":4277921907351385,"guid":"a8a835b4-b126-46b0-b7ea-79a51396b4bd","subtype":"command","commandType":"auto","position":9.0,"command":"%sql\nSELECT COUNT(1)\n  FROM f1_processed.results;","commandVersion":22,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"270","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cf65d547-43e7-404e-9891-8c714194b982"},{"version":"CommandV1","origId":4277921907351386,"guid":"25c5f45b-1ae4-40c6-985f-9d8ba35d5d35","subtype":"command","commandType":"auto","position":13.0,"command":"%sql\nSELECT race_id, driver_id, COUNT(1) \nFROM f1_processed.results\nGROUP BY race_id, driver_id\nHAVING COUNT(1) > 1\nORDER BY race_id, driver_id DESC;","commandVersion":19,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"368","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b6fb635d-6758-4ca5-9e78-193411432cd3"},{"version":"CommandV1","origId":4277921907351387,"guid":"b3e5dc05-7c18-453e-9471-5d451c38a467","subtype":"command","commandType":"auto","position":14.0,"command":"%sql SELECT * FROM f1_processed.results WHERE race_id = 540 AND driver_id = 229;","commandVersion":19,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"2396","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4fe9b325-b4c4-4238-9039-7a762589c9f8"},{"version":"CommandV1","origId":4277921907351388,"guid":"f3938d8e-4c40-414e-b9ae-dc2200a1ca5f","subtype":"command","commandType":"auto","position":21.0,"command":"","commandVersion":0,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a3ed029a-adae-4eda-b27a-e7406f9a4a6e"}],"dashboards":[],"guid":"b414e866-6d7d-44a6-b083-d7fc14e955c4","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"p_data_source":{"nuid":"6ae13916-9f47-4659-88eb-b4196b247985","currentValue":"Ergast","widgetInfo":{"widgetType":"text","name":"p_data_source","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}}},"p_file_date":{"nuid":"bb7aaf1a-800d-457a-811d-7999eb74a28c","currentValue":"2021-04-18","widgetInfo":{"widgetType":"text","name":"p_file_date","defaultValue":"2021-03-28","label":null,"options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":2}}